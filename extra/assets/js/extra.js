const K="extra_token_v1",H="8a58aa3f0832466d22df3e2710a5c0120e9e72b74fd5a1feb8ac564c4feae8a5",S="v1::nick::secret",SECRET_PAYLOAD_B64="eyJ0aXRsZSI6IkhBUFBZIDI1IEJJUlRIREFZISEhIiwic3VidGl0bGUiOiJJIG1hZGUgdGhpcyBhbGwgZm9yIHlvdSEgQWxzbywgYmVjYXVzZSB5b3UgZm91bmQgdGhpcywgSSBnb3QgeW91IHRoZSB3b3JsZHMgbW9zdCBleHBlbnNpdmUgZGlldCBjb2tlISAobG9vayBhdCB5b3VyIHplbGxlKSIsIm1lc3NhZ2VUaXRsZSI6IlRoaXMgaXMgeW91ciB2ZXJ5IG93biB3ZWJzaXRlISIsIm1lc3NhZ2VCb2R5IjoiQWJvdmUgYXJlIHNvbWUgcGljdHVyZXMgb2YgbWUgYW5kIHRoZSBiZXN0IGdpcmxmcmllbmQgSSBjYW4gZXZlciBhc2sgZm9yLCBhbmQgSSBhbSBzbyBoYXBweSBJIGdldCB0byBiZSBhcGFydCBvZiB5b3VyIDI1IHllYXJzIHlvdW5nIG9mIGxpZmUsIFNvIG1hbnkgbW9yZSB0byBjb21lISEgQmVsb3cgaXMgaG93IEkgd291bGQgZGVzY3JpYmUgeW91IHRvIGFueW9uZSB3aG8gYXNrcyEiLCJjaGlwcyI6WyJLaW5kIiwiRnVubnkiLCJCZWF1dGlmdWwiLCJCZXN0IEZyaWVuZCIsIkhhcmRlc3QgV29ya2VyIiwiTmljZSIsIk1vdGl2YXRpbmciLCJNYWtlIE1lIFNtaWxlIEV2ZXJ5ZGF5IiwiVGhlIEJlc3QgRVZFUiJdLCJzdG9yeVNlY3Rpb25UaXRsZSI6IkhhcHB5IEJpcnRoZGF5IFN0YXIhIiwiY2FyZEhlYWRlclRpdGxlIjoiQSBtZXNzYWdlIGZvciB5b3UiLCJjYXJkSGVhZGVyU3VidGl0bGUiOiJKdXN0IGEgbGl0dGxlIG5vdGUgZnJvbSBtZSIsImNhcmRCb2R5MSI6IllvdSBhcmUgZmluYWxseSAyNSB5ZWFycyB5b3VuZyEgWW91IGhhdmUgYWNjb21wbGlzaGVkIHNvIG11Y2ggYW5kIEkgYW0gYmV5b25kIHByb3VkIG9mIHlvdSEgWW91IGFyZSB0aGUgaGFyZGVzdCB3b3JrZXIgZXZlciwgYW5kIHlvdSBtb3RpdmF0ZSBtZSB0byBiZSBteSBiZXN0LCB3aGljaCBpcyBvbmUgb2YgdGhlIHJlYXNvbnMgd2h5IEkgbG92ZSB5b3UhIEdldHRpbmcgeW91ciBtYXN0ZXJzIGRlZ3JlZSBhbmQgdGhlbiBiZWluZyB0aGUgYmVzdCB3b3JrZXIgYXQgeW91ciBqb2IgaXMgc28gaW1wcmVzc2l2ZSwgYW5kIEkga25vdyB5b3UgYXJlIGdvaW5nIHRvIGRvIGFtYXppbmcgdGhpbmdzISBJIGV2ZW4gc2F3IGl0IHdoZW4geW91IHdlcmUgdGhlIGJlc3QgbWFuYWdlciBhdCB3b3JrISIsImNhcmRCb2R5MiI6IkkgbWFkZSB0aGlzIHdlYnNpdGUgcGFnZSBhbGwgZm9yIHlvdSEgSSB0aG91Z2h0IHRoaXMgd291bGQgYmUgYSBjb29sZXIgdGhhbiBtYWtpbmcgYSBib3JpbmcgY2FyZCBsb2wuIFlvdSBtYWtlIG1lIHNvIGhhcHB5IGFuZCBJIGFtIHNvIGdyYXRlZnVsIHRvIGhhdmUgeW91IGluIG15IGxpZmUhIFdpdGggYWxsIG9mIHRoZSBoaWdocyBhbmQgbG93cywgeW91IGhhdmUgYWx3YXlzIGJlZW4gdGhlcmUgZm9yIG1lLCBhbmQgdGhlIGJlc3QgcGFydCBpcyB5b3UgYXJlIGFsd2F5cyB5b3Vyc2VsZiwgbmV2ZXIgY2hhbmdlIHRoYXQhIEJlbG93IGlzIGEgdGltZXIgdGhhdCBjb3VudHMgaG93IGxvbmcgd2UgaGF2ZSBiZWVuIG9mZmljaWFsLCBhbmQgdGhlIHRpbWUgd2lsbCBhbHdheXMgZ28gdXAuIEkgTE9WRSBZT1UsIGFuZCBoYXBweSBiaXJ0aGRheSBob25leSEifQ==",$=t=>document.getElementById(t),hex=t=>[...new Uint8Array(t)].map((t=>t.toString(16).padStart(2,"0"))).join("");async function sha256(t){const e=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t));return hex(e)}const tokenFromHash=t=>sha256(t+S);async function valid(){const t=sessionStorage.getItem(K);return!!t&&t===await tokenFromHash(H)}function lock(){sessionStorage.removeItem(K),window.location.href="./"}function b64ToUtf8(t){const e=atob(t),n=Uint8Array.from(e,(t=>t.charCodeAt(0)));return(new TextDecoder).decode(n)}function esc(t){return String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function inject(t){const e=$("loveTitle"),n=$("loveSubtitle"),l=$("messageTitle"),a=$("messageBody"),o=$("chipsWrap");e&&(e.textContent=t.title||""),n&&(n.textContent=t.subtitle||""),l&&(l.textContent=t.messageTitle||""),a&&(a.textContent=t.messageBody||""),o&&(o.innerHTML="",(t.chips||[]).forEach((t=>{const e=document.createElement("span");e.className="chip",e.textContent=t,o.appendChild(e)})));const d=$("storySectionTitle"),c=$("cardHeaderTitle"),I=$("cardHeaderSubtitle"),i=$("cardBody1"),g=$("cardBody2");d&&(d.textContent=t.storySectionTitle||""),c&&(c.textContent=t.cardHeaderTitle||""),I&&(I.textContent=t.cardHeaderSubtitle||""),i&&(i.textContent=t.cardBody1||""),g&&(g.textContent=t.cardBody2||"")}function pad2(t){return String(t).padStart(2,"0")}function addMonths(t,e){const n=new Date(t),l=n.getDate();return n.setMonth(n.getMonth()+e),n.getDate()!==l&&n.setDate(0),n}function diffCal(t,e){if(e<t)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};let n=e.getFullYear()-t.getFullYear(),l=new Date(t);l.setFullYear(t.getFullYear()+n),l>e&&(n--,l=new Date(t),l.setFullYear(t.getFullYear()+n));let a=e.getMonth()-l.getMonth()+12*(e.getFullYear()-l.getFullYear()),o=addMonths(l,a);o>e&&(a--,o=addMonths(l,a));const d=e-o,c=6e4,I=60*c,i=24*I;return{years:n,months:a,days:Math.floor(d/i),hours:Math.floor(d%i/I),minutes:Math.floor(d%I/c),seconds:Math.floor(d%c/1e3)}}function together(){const t=$("togetherYears"),e=$("togetherMonths"),n=$("togetherDays"),l=$("togetherHours"),a=$("togetherMinutes"),o=$("togetherSeconds");if(!(t&&e&&n&&l&&a&&o))return;const d=new Date("2024-06-22T19:00:00"),c=()=>{const c=diffCal(d,new Date);t.textContent=c.years,e.textContent=c.months,n.textContent=c.days,l.textContent=pad2(c.hours),a.textContent=pad2(c.minutes),o.textContent=pad2(c.seconds)};c(),setInterval(c,1e3)}function initGate(){const t=$("gateForm"),e=$("pw"),n=$("status");t&&e&&(valid().then((t=>{t&&(window.location.href="p.html")})),t.addEventListener("submit",(async t=>{t.preventDefault(),n&&(n.textContent="Checking...");const l=e.value.trim(),a=await sha256(l);if(a===H)return sessionStorage.setItem(K,await tokenFromHash(a)),void(window.location.href="p.html");n&&(n.textContent="Wrong password."),e.value="",e.focus()})))}async function initSecret(){if(!$("secretCard"))return;if(!await valid())return void window.location.replace("./");const t=$("lockBtn");t&&t.addEventListener("click",lock),inject(JSON.parse(b64ToUtf8(SECRET_PAYLOAD_B64))),together()}document.addEventListener("DOMContentLoaded",(()=>{initGate(),initSecret()}));